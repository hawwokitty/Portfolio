"use strict";
Object.defineProperty(exports, Symbol.toStringTag, { value: "Module" });
const React = require("react");
const Draggable = require("react-draggable");
const Button = require("../Button/Button.cjs");
const TitleBar = require("../TitleBar/TitleBar.cjs");
const ModalContext = require("./ModalContext.cjs");
const Modal_css = require("./Modal.css.cjs");
const Frame = require("../Frame/Frame.cjs");
const close = require("./close.svg.cjs");
const help = require("./help.svg.cjs");
const ModalRenderer = ({
  hasWindowButton: hasButton = true,
  buttons = [],
  buttonsAlignment = "flex-end",
  children,
  onClose = () => {
  },
  onHelp,
  defaultPosition = { x: 0, y: 0 },
  positionOffset,
  height,
  icon,
  menu = [],
  title,
  width,
  ...rest
}, ref) => {
  const {
    addWindows,
    removeWindow,
    updateWindow,
    setActiveWindow,
    activeWindow
  } = React.useContext(ModalContext.ModalContext);
  const [id, setId] = React.useState(null);
  const [menuOpened, setMenuOpened] = React.useState("");
  const [isActive, setIsActive] = React.useState(false);
  React.useEffect(() => {
    if (!id) {
      const newId = addWindows({ icon, title, hasButton });
      if (newId) {
        setId(newId);
        setActiveWindow(newId);
      }
    } else {
      updateWindow(id, { icon, title, hasButton });
    }
  }, [id, icon, title, hasButton]);
  React.useEffect(() => {
    return () => {
      if (id) {
        removeWindow(id);
      }
    };
  }, [id]);
  React.useEffect(() => setIsActive(id === activeWindow), [id, activeWindow]);
  return /* @__PURE__ */ React.createElement(
    Draggable,
    {
      handle: ".draggable",
      defaultPosition,
      positionOffset,
      onMouseDown: id ? () => setActiveWindow(id) : void 0
    },
    /* @__PURE__ */ React.createElement(
      Frame.Frame,
      {
        ...rest,
        width,
        height,
        className: Modal_css.modalWrapper({ active: isActive }),
        ref
      },
      /* @__PURE__ */ React.createElement(
        TitleBar.TitleBar,
        {
          active: isActive,
          icon,
          title,
          className: "draggable"
        },
        /* @__PURE__ */ React.createElement(TitleBar.TitleBar.OptionsBox, null, onHelp && /* @__PURE__ */ React.createElement(TitleBar.TitleBar.Option, null, /* @__PURE__ */ React.createElement("img", { src: help, alt: "help", onClick: onHelp })), /* @__PURE__ */ React.createElement(TitleBar.TitleBar.Option, { onClick: onClose }, /* @__PURE__ */ React.createElement("img", { src: close, alt: "close" })))
      ),
      menu && menu.length > 0 && /* @__PURE__ */ React.createElement("ul", { className: Modal_css.menuWrapper }, menu.map(({ name, list }) => {
        const active = menuOpened === name;
        return /* @__PURE__ */ React.createElement(
          "li",
          {
            key: name,
            onMouseDown: () => setMenuOpened(name),
            className: Modal_css.menuItem({ active })
          },
          name,
          active && list
        );
      })),
      /* @__PURE__ */ React.createElement("div", { className: Modal_css.content, onClick: () => setMenuOpened("") }, children),
      buttons && buttons.length > 0 && /* @__PURE__ */ React.createElement(
        Frame.Frame,
        {
          className: Modal_css.buttonWrapper,
          justifyContent: buttonsAlignment
        },
        buttons.map((button) => /* @__PURE__ */ React.createElement(
          Button.Button,
          {
            key: button.value,
            onClick: button.onClick,
            value: button.value
          },
          button.value
        ))
      )
    )
  );
};
const Modal = React.forwardRef(ModalRenderer);
Modal.displayName = "Modal";
Modal.defaultProps = {
  icon: void 0,
  title: "Modal",
  children: null,
  defaultPosition: { x: 0, y: 0 },
  buttons: [],
  menu: [],
  width: void 0,
  height: void 0,
  onClose: () => {
  }
};
exports.Modal = Modal;
